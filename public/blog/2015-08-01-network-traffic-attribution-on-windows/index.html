
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Network Traffic Attribution on Windows - Parsiya's Den</title>
  <meta name="author" content="Parsiya">

  
  <meta name="description" content="Thick client assessments come in different flavors. Most of our work is on consumer applications where consumer means either the customer or an &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://parsiya.net/blog/2015-08-01-network-traffic-attribution-on-windows">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Parsiya's Den" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- start image popup stuff -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>

<!-- end image popup stuff -->

<!-- Look at me, I am looking at source!!11! -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55491306-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Parsiya's Den</a></h1>
  
    <h2>Because no one wants to be the other guy in Wham!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:parsiya.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <!-- <li><a href="/about.html">About Me</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Network Traffic Attribution on Windows</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-01T19:37:42-04:00" pubdate data-updated="true">Aug 1<span>st</span>, 2015</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://parsiya.net">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Thick client assessments come in different flavors. Most of our work is on <code>consumer applications</code> where <code>consumer</code> means either the customer or an employee of our client. But these applications usually have network communications.</p>

<p>When looking at thick client applications from a network traffic perspective, we face two big challenges:</p>

<ol>
  <li>
    <p><strong>Traffic Attribution</strong> or <strong>Where does this traffic come from?</strong>: How to we identify application’s traffic? The operating system (in this case Windows) is running many applications and services. Each of them may have network connectivity.</p>
  </li>
  <li>
    <p><strong>Proxying Traffic</strong> or <strong>How do I look view/modify traffic?</strong>: This is more challenging and involves capturing, modifying and in a lot of cases decrypting/decoding target application’s traffic. This could be as easy as setting up Burp via an application setting (EZ-mode) or as hard as setting up your own access point to capture a device’s traffic then developing your own decryption plugin for your proxy tool (good luck).</p>
  </li>
</ol>

<p>In this post, I will be talking about the much easier first challenge. I will be talking about some of the tools and techniques that I use to accomplish this. This is not a groundbreaking post ;). We will use a simple application, in this case <code>notepad++</code>.</p>

<!-- more -->

<h3 id="our-setup">1. Our Setup</h3>

<p>I am using Windows 7 VM running via VirtualBox. You can probably use anything newer than Windows XP. You can get VMs from Microsoft at [http://dev.modern.ie/tools/vms/windows/][modern-ie]. These VMs have 90 day activation periods and are for testing different versions of IE but they are enough for our purpose. One downside is the huge virtual disk drive (110GB) that can be shrinked (from inside Windows) in half. Hard drive is still dynamically located but if you do not watch out, it wills tart filling up your hard drive (especially if you are making snapshots).</p>

<h3 id="list-of-tools">2. List of Tools</h3>

<ol>
  <li><strong>Microsoft Network Monitor (Netmon)</strong>: <a href="http://blogs.technet.com/b/netmon/p/downloads.aspx">http://blogs.technet.com/b/netmon/p/downloads.aspx</a></li>
  <li><strong>Wireshark</strong>: <a href="https://www.wireshark.org/download.html">https://www.wireshark.org/download.html</a></li>
  <li><strong>Process Monitor (Procmon)</strong>: Part of Microsoft Sysinternals Suite: <a href="https://technet.microsoft.com/en-us/sysinternals/bb842062.aspx">https://technet.microsoft.com/en-us/sysinternals/bb842062.aspx</a></li>
</ol>

<h3 id="test-application">3. Test Application</h3>

<p>I will be using <code>Notepad++ 6.7.9.2</code>. it was the current version at the time of writing but by the time I got to publishing this post it has been updated to version <code>6.8</code>. You can download it from <a href="https://notepad-plus-plus.org/download/v6.7.9.2.html">https://notepad-plus-plus.org/download/v6.7.9.2.html</a>. Install Notepad++ but make sure to select <code>Auto Updater</code> and <code>Plugin Manager</code> during installation. <strong>Do not run the application at the end of the installation process</strong>.</p>

<h3 id="traffic-attribution">4. Traffic Attribution</h3>

<p>Run Netmon, Wireshark and Procmon (as Administrator) then run <code>Notepad++</code>.</p>

<p><strong>Procmon Note</strong>: Never select <code>Drop Filtered Events</code> in the Filter menu. It will discard all events that are not shown by your filters. There is no going back to viewing filtered events.</p>

<h4 id="netmon">4.1 Netmon</h4>

<p>We can see a bunch of traffic in Netmon. See this handy tree view to the left? That is why we are using it ;).</p>

<p>Click on <code>notepad++.exe</code> in the tree view to view all of its traffic. We can see that it is communicating with <code>superb-dca2.dl.sourceforge.net</code> and <code>downloads.sourceforge.net</code> over HTTP <em>gasp</em>. You may observe a different endpoint depending on your location (because Source forge).</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-3">
    <img src="/images/2015/TrafficAttribution1/01.PNG" width="997" height="366" alt="Click me." />
  </a>
  <div id="image-dialog-3" style="display:none">
    <img src="/images/2015/TrafficAttribution1/01.PNG" width="1246" height="458" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-3").hide();
    jQuery("#image-dialog-3").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1286,
      minHeight: 498,
      title:     "Notepad++ traffic in Netmon ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-3").click(function() {
      jQuery("#image-dialog-3").dialog('open');
    });

  });
</script>
</notextile></div>

<p>There’s another <code>suspicious process</code> up there. Select <code>gup.exe</code> and we can see it is also related to <code>Notepad++</code> as it’s creating a TLS connection to <code>notepad-plus-plus.org</code>.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-4">
    <img src="/images/2015/TrafficAttribution1/02.PNG" width="922" height="399" alt="Click me." />
  </a>
  <div id="image-dialog-4" style="display:none">
    <img src="/images/2015/TrafficAttribution1/02.PNG" width="1153" height="499" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-4").hide();
    jQuery("#image-dialog-4").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1193,
      minHeight: 539,
      title:     "gup.exe traffic in Netmon ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-4").click(function() {
      jQuery("#image-dialog-4").dialog('open');
    });

  });
</script>
</notextile></div>

<p>But wait, there’s more. There may be traffic that is not correctly attributed due to the way that Netmon identifies traffic. We may be able to find some extra stuff there.<br />
Here’s a Catch-22, there may be traffic related to our application that Netmon wasn’t able to correlate back to the process but how can we identify it if we do not know the endpoints. We will be using Procmon to compile a more comprehensive endpoint collection later.</p>

<h5 id="how-to-search-in-netmon">4.1.1 How to search in Netmon?</h5>
<p><code>Contains</code> is a filter that allows us to do case-insensitive searchs for strings. For example we can use this filter to search for packets with destinations containing the string <code>sourceforge</code>. We can use the following filters (they both do the same thing):</p>

<ul>
  <li><code>Contains(property.Destination, "sourceforge")</code></li>
  <li><code>Destination.Contains("sourceforge")</code></li>
</ul>

<p>Be sure to select <code>All Traffic</code> in the tree-view when applying filters search in all traffic.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-5">
    <img src="/images/2015/TrafficAttribution1/03.PNG" width="986" height="390" alt="Click me." />
  </a>
  <div id="image-dialog-5" style="display:none">
    <img src="/images/2015/TrafficAttribution1/03.PNG" width="1232" height="487" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-5").hide();
    jQuery("#image-dialog-5").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1272,
      minHeight: 527,
      title:     "Contains(property.Destination, 'sourceforge') ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-5").click(function() {
      jQuery("#image-dialog-5").dialog('open');
    });

  });
</script>
</notextile></div>

<p>We can search in different columns, one of the most common columns is <code>property.description</code>. Description is a column with a lot of information and is usually our best bet. For example if we want to see all GET request we can use the following filters (again they both do the same thing):</p>

<ul>
  <li><code>Contains(property.Description,"GET")</code></li>
  <li><code>Description.Contains("GET")</code></li>
</ul>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-6">
    <img src="/images/2015/TrafficAttribution1/04.PNG" width="1179" height="346" alt="Click me." />
  </a>
  <div id="image-dialog-6" style="display:none">
    <img src="/images/2015/TrafficAttribution1/04.PNG" width="1474" height="432" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-6").hide();
    jQuery("#image-dialog-6").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1514,
      minHeight: 472,
      title:     "Contains(property.Description,'GET') ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-6").click(function() {
      jQuery("#image-dialog-6").dialog('open');
    });

  });
</script>
</notextile></div>

<p>We can also see Windows checking for certificate revocation lists over HTTP <em>zomg</em>.</p>

<p>To search for binary data use <code>ContainsBin</code>. For example to search for the CRLF binary string in frame data use this filter:</p>

<ul>
  <li><code>ContainsBin(FrameData, HEX, "0D 0A")</code></li>
</ul>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-7">
    <img src="/images/2015/TrafficAttribution1/05.PNG" width="980" height="334" alt="Click me." />
  </a>
  <div id="image-dialog-7" style="display:none">
    <img src="/images/2015/TrafficAttribution1/05.PNG" width="1225" height="418" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-7").hide();
    jQuery("#image-dialog-7").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1265,
      minHeight: 458,
      title:     "ContainsBin(FrameData, HEX, '0D 0A') ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-7").click(function() {
      jQuery("#image-dialog-7").dialog('open');
    });

  });
</script>
</notextile></div>

<p>We can also search for strings using <code>ContainsBin</code> by using <code>ASCII</code>. But remember this search is case-sensitive. To replicate our previous search for <code>sourceforge</code> we can use the following filter:</p>

<ul>
  <li><code>ContainsBin(FrameData, ASCII, "sourceforge")</code></li>
</ul>

<h4 id="procmon">4.2 Procmon</h4>
<p>Procmon does not display traffic but it’s a great tool to identify enpoints. Stop the Procmon capture. It is time to add Procmon filters.</p>

<p>I am in the process of writing a longer blog entry about using Procmon but that is for another day. For now we will discuss some filters related to network endpoint discovery.</p>

<p>Procmon has a lot of filters but we will be using only a few of them. The first filter is <code>ProcessName</code>. Using this filter we can see only events belonging to specific process(es). Select Filter from the Filter menu or press Ctrl+L. Now create this filter <code>ProcessName is Notepad++.exe</code>. Note that Procmon will show you all processes with events in the drop down menu.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-8">
    <img src="/images/2015/TrafficAttribution1/06.PNG" width="426" height="368" alt="Click me." />
  </a>
  <div id="image-dialog-8" style="display:none">
    <img src="/images/2015/TrafficAttribution1/06.PNG" width="532" height="460" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-8").hide();
    jQuery("#image-dialog-8").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  572,
      minHeight: 500,
      title:     "Creating a filter ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-8").click(function() {
      jQuery("#image-dialog-8").dialog('open');
    });

  });
</script>
</notextile></div>

<p>And we can see all events for <code>notepad++.exe</code> in Procmon. Take a note of ProcessID (PID) for <code>notepad++.exe</code>. In this case PID is <code>3964</code>.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-9">
    <img src="/images/2015/TrafficAttribution1/07.PNG" width="724" height="357" alt="Click me." />
  </a>
  <div id="image-dialog-9" style="display:none">
    <img src="/images/2015/TrafficAttribution1/07.PNG" width="905" height="446" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-9").hide();
    jQuery("#image-dialog-9").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  945,
      minHeight: 486,
      title:     "ProcessName is notepad++.exe ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-9").click(function() {
      jQuery("#image-dialog-9").dialog('open');
    });

  });
</script>
</notextile></div>

<p>But we want to look at spawned processes too. Let’s remove this filter and find all child processes for <code>notepad++.exe</code> using another filter. The new filter is <code>Parent PID is 3964</code>and it will show captured events for <code>gup.exe</code>.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-10">
    <img src="/images/2015/TrafficAttribution1/08.PNG" width="747" height="437" alt="Click me." />
  </a>
  <div id="image-dialog-10" style="display:none">
    <img src="/images/2015/TrafficAttribution1/08.PNG" width="934" height="546" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-10").hide();
    jQuery("#image-dialog-10").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  974,
      minHeight: 586,
      title:     "ProcessName is Parent PID is 3964 ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-10").click(function() {
      jQuery("#image-dialog-10").dialog('open');
    });

  });
</script>
</notextile></div>

<p>Doubleclick on the first line (<code>Process Start</code>) to view command line parameters and other details for <code>gup.exe</code>. Note that the <code>gup.exe</code> application was ran with parameter <code>-v6.792</code> (version of Notepad++). So theoretically we can pretend that we are any version. It would be nice to look at this request and play with it.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-11">
    <img src="/images/2015/TrafficAttribution1/09.PNG" width="508" height="609" alt="Click me." />
  </a>
  <div id="image-dialog-11" style="display:none">
    <img src="/images/2015/TrafficAttribution1/09.PNG" width="635" height="761" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-11").hide();
    jQuery("#image-dialog-11").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  675,
      minHeight: 801,
      title:     "ProcessName is gup.exe and ProcessStart ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-11").click(function() {
      jQuery("#image-dialog-11").dialog('open');
    });

  });
</script>
</notextile></div>

<p>An alternate way to get the same results is to use these two filter:</p>

<ul>
  <li><code>ProcessName is notepad++.exe</code></li>
  <li><code>Operation is Process Create</code></li>
</ul>

<p>If we want to make sure that we have identified all processes, we have to go one level deeper and check if <code>gup.exe</code> spawned any other processes.</p>

<p>We have two options:</p>

<ol>
  <li><code>ProcessName is gup.exe</code> and <code>Operation is Process Create</code></li>
  <li><code>Parent PID is 3992</code> (pid of <code>gup.exe</code>)</li>
</ol>

<p>But as expected both filters return nothing. <code>gup.exe</code> did not spawn anything.</p>

<p>Now we can add both <code>notepad++.exe</code> and <code>gup.exe</code> as filters to view all events related to our application in Procmon.</p>

<p>In order to watch network traffic we can use the handy <code>Operation is TCP Send</code> filter. Note there are other operations (i.e. UDP ones). <code>TCP Connect</code> will also work if you just want endpoints and less noise.</p>

<p>We use the following filters:</p>

<ol>
  <li><code>ProcessName is notepad++.exe</code></li>
  <li><code>ProcessName is gup.exe</code></li>
  <li><code>Operation is TCP Send</code></li>
  <li><code>Operation is TCP Connect</code></li>
</ol>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-12">
    <img src="/images/2015/TrafficAttribution1/10.PNG" width="737" height="211" alt="Click me." />
  </a>
  <div id="image-dialog-12" style="display:none">
    <img src="/images/2015/TrafficAttribution1/10.PNG" width="921" height="264" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-12").hide();
    jQuery("#image-dialog-12").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  961,
      minHeight: 304,
      title:     "Operation is TCP Connect and TCP Send ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-12").click(function() {
      jQuery("#image-dialog-12").dialog('open');
    });

  });
</script>
</notextile></div>

<p>We have already seen <code>downloads.sourceforge.net</code> but <code>ns378545.ip-91-121-64.eu</code> is new.</p>

<p>If we ping it, we can see that the corresponding IP address is <code>91.121.64.34</code>. We can filter the results in Netmon by using this filter <code>IPv4.Address == 91.121.64.34</code> to view traffic related to his IP address.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-13">
    <img src="/images/2015/TrafficAttribution1/11.PNG" width="918" height="341" alt="Click me." />
  </a>
  <div id="image-dialog-13" style="display:none">
    <img src="/images/2015/TrafficAttribution1/11.PNG" width="1147" height="426" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-13").hide();
    jQuery("#image-dialog-13").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1187,
      minHeight: 466,
      title:     "IPv4.Address == 91.121.64.34 ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-13").click(function() {
      jQuery("#image-dialog-13").dialog('open');
    });

  });
</script>
</notextile></div>

<p>It is <code>notepad-plus-plus.org</code>. Try pinging <code>notepad-plus-plus.org</code> to get <code>91.121.64.34</code>.</p>

<p>That was easy wasn’t it?</p>

<p>What did we do? We used Netmon and Procmon to identify the endpoints that an specific application communicates with and isolate traffic belonging to that application. I told you this is nothing ground breaking :).</p>

<h3 id="questions">Questions:</h3>

<p><strong>But what about Microsoft Message Analyzer (MMA)?</strong></p>

<p>It is a good tool. But I do not like its UI but I saw an interesting feature in it to decrypt SSL traffic. I will be looking at that feature soon. It is also much more resource intensive than Netmon.</p>

<p>For more information: <a href="http://blogs.technet.com/b/messageanalyzer/archive/2015/06/08/process-tracking-with-message-analyzer.aspx">http://blogs.technet.com/b/messageanalyzer/archive/2015/06/08/process-tracking-with-message-analyzer.aspx</a></p>

<p><strong>But I want to use Wireshark</strong></p>

<p>Sure, go ahead. Use Procmon and filters to identify the endpoints and then add filters in Wireshark. Another good thing is that Netmon’s export format (*.cap files) can be opened in Wireshark. If you prefer Wireshark’s UI, you can isolate traffic by process in Netmon, save it and then open the resulting cap file in Wireshark.</p>

<p><strong>Where are DNS requests? I do not see them in process traffic in Netmon</strong></p>

<p>Select all traffic and use the filter <code>DNS</code>. Due to the way Netmon associates traffic with processes, DNS requests may be in Unknown or System.</p>

<div class="bogus-wrapper"><notextile><div class="imgpopup screen">
  <a href="javascript:void(0)" style="text-decoration: none" id="image-14">
    <img src="/images/2015/TrafficAttribution1/12.PNG" width="1031" height="310" alt="Click me." />
  </a>
  <div id="image-dialog-14" style="display:none">
    <img src="/images/2015/TrafficAttribution1/12.PNG" width="1289" height="388" />
    <br clear="all" />
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#image-dialog-14").hide();
    jQuery("#image-dialog-14").dialog({
      autoOpen:  false,
      modal:     true,
      draggable: false,
      minWidth:  1329,
      minHeight: 428,
      title:     "DNS ",
      show:      'scale',
      hide:      'scale'
    });

    jQuery("#image-14").click(function() {
      jQuery("#image-dialog-14").dialog('open');
    });

  });
</script>
</notextile></div>

<p>Note that while we had a DNS query for <code>superb-dca2.dl.sourceforge.net</code>, we never connected to it so we did not see a <code>TCP Connect</code> event for it in Procmon.</p>

<h3 id="exercise">5. Exercise:</h3>
<p>Run the tools again and install a plugin. This can be accomplished by going to <code>Plugins &gt; Plugin Manager &gt; Show Plugin Manager</code>. Try to locate the endpoints and traffic in this case. See what process is spawned by <code>notepad++.exe</code> this time.</p>

<p>This time, it will not be as easy as last time because Netmon did not associate all packets with the process but you can find the endpoints via Procmon and filter them in Netmon.</p>

<p>I hope this was useful. If you have any questions, you know where to find me.</p>

<!-- links -->

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Parsiya</span></span>

      








  


<time datetime="2015-08-01T19:37:42-04:00" pubdate data-updated="true">Aug 1<span>st</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015-07-26-image-popup-and-octopress/" title="Previous Post: Image Popup and Octopress">&laquo; Image Popup and Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2015-10-08-hipchat-part-1-where-did-the-traffic-go/" title="Next Post: Proxying Hipchat Part 1: Where did the Traffic Go?">Proxying Hipchat Part 1: Where did the Traffic Go? &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Who am I?</h1>
  <p>I am Parsia Hakimian, ex-dev and current (mostly) software security consultant at <a href="http://www.cigital.com/" target="_blank">Cigital</a> .</p>
  <p>I am interested in Reverse Engineering, Crypto, Assembly, C, Python, EvE Online and other things (not necessarily in that order).</p>
  <p>bitbucket: <a href="https://bitbucket.org/parsiya/" target="_blank">https://bitbucket.org/parsiya/</a></p>
  <p>email: parsiya [at] google's email [dot]com</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015-10-08-hipchat-part-1-where-did-the-traffic-go/">Proxying Hipchat Part 1: Where Did the Traffic Go?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-01-network-traffic-attribution-on-windows/">Network Traffic Attribution on Windows</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-07-26-image-popup-and-octopress/">Image Popup and Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-01-06-tales-from-the-crypt-o-leaking-aes-keys/">Tales From the Crypt(o) - Leaking AES Keys</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-12-08-pin-adventures-chapter-1-pinsolver-mk1/">Pin Adventures - Chapter 1 - PinSolver Mk1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-18-building-memfetch-on-kali/">Building Memfetch on Kali + Comments</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-10-07-my-adventure-with-fireeye-flare-challenge/">My Adventure With Fireeye FLARE Challenge</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-09-21-malware-adventure/">Malware Adventure</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-09-02-fireeyes-flare-challenge/">Fireeye's FLARE Challenge</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-07-03-apples-common-crypto-library-defaults-to-a-zero-iv-if-one-is-not-provided/">Apple's Common Crypto Library Defaults to a Zero IV if One Is Not Provided</a>
      </li>
    
  </ul>
</section>
<section>
    <h1>Twitter</h1>
    <a class="twitter-timeline"  href="https://twitter.com/CryptoGangsta"  data-widget-id="458841047112482817">Tweets by @CryptoGangsta</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Parsiya -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'parsiya';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://parsiya.net/blog/2015-08-01-network-traffic-attribution-on-windows/';
        var disqus_url = 'http://parsiya.net/blog/2015-08-01-network-traffic-attribution-on-windows/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
