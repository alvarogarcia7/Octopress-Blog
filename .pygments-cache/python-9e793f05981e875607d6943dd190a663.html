<div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span> <span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="c"># shellcode</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x41</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="c"># opens gdb with parameter executable</span>
<span class="c"># you can also manage stdout and stderr here</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;gdb&#39;</span> <span class="p">,</span> <span class="s">&#39;executable&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span> <span class="p">,</span><span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span> <span class="p">)</span>

<span class="c"># sample breakpoint</span>
<span class="c"># notice the new line after each command</span>
<span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;b *DEADBEEF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

<span class="c"># half a second of sleep after each command</span>
<span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c"># r or run to start debugging the program with GDB</span>
<span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;r</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c"># any other commands go here</span>

<span class="c"># this is a loop, will get every command and pass it to GDB</span>
<span class="c"># &quot;leave&quot; == quit GDB and terminate process</span>
<span class="c"># &quot;dump&quot;  == paste shellcode</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">mycommand</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mycommand</span> <span class="o">==</span> <span class="s">&quot;leave&quot;</span><span class="p">):</span>
        <span class="c"># quit gdb</span>
        <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;quit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">break</span>
	
    <span class="c"># paste shellcode</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mycommand</span> <span class="o">==</span> <span class="s">&quot;dump&quot;</span><span class="p">):</span>
        <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
    <span class="c"># more custom commands go here</span>

    <span class="c"># not a custom command? send it as-is</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mycommand</span> <span class="o">=</span> <span class="n">mycommand</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> 
        <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mycommand</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c"># close our pipe	</span>
<span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>